<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>TinyLlama Browser</title>
    <style>
        * {
            box-sizing: border-box;
            margin: 0;
            padding: 0;
        }
        
        body {
            font-family: 'Segoe UI', Tahoma, Geneva, Verdana, sans-serif;
            line-height: 1.6;
            color: #333;
            background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
            min-height: 100vh;
            padding: 20px;
            display: flex;
            justify-content: center;
            align-items: center;
        }
        
        .container {
            width: 100%;
            max-width: 800px;
            background: rgba(255, 255, 255, 0.95);
            border-radius: 15px;
            box-shadow: 0 10px 30px rgba(0, 0, 0, 0.15);
            overflow: hidden;
        }
        
        header {
            background: linear-gradient(90deg, #4b6cb7 0%, #182848 100%);
            color: white;
            padding: 20px;
            text-align: center;
        }
        
        h1 {
            font-size: 1.8rem;
            margin-bottom: 5px;
        }
        
        .subtitle {
            font-size: 1rem;
            opacity: 0.8;
        }
        
        .main-content {
            padding: 20px;
        }
        
        .status-panel {
            background: #f8f9fa;
            border-radius: 10px;
            padding: 15px;
            margin-bottom: 20px;
            border-left: 4px solid #4b6cb7;
        }
        
        .status-item {
            display: flex;
            justify-content: space-between;
            margin-bottom: 8px;
        }
        
        .progress-container {
            margin: 15px 0;
        }
        
        progress {
            width: 100%;
            height: 10px;
            border-radius: 5px;
        }
        
        .chat-container {
            background: white;
            border-radius: 10px;
            border: 1px solid #e0e0e0;
            height: 300px;
            overflow-y: auto;
            padding: 15px;
            margin-bottom: 20px;
        }
        
        .message {
            margin-bottom: 15px;
            padding: 10px 15px;
            border-radius: 10px;
            max-width: 80%;
        }
        
        .user-message {
            background: #e3f2fd;
            margin-left: auto;
            border-bottom-right-radius: 3px;
        }
        
        .ai-message {
            background: #f5f5f5;
            margin-right: auto;
            border-bottom-left-radius: 3px;
        }
        
        .input-area {
            display: flex;
            gap: 10px;
        }
        
        input {
            flex: 1;
            padding: 12px 15px;
            border: 1px solid #ddd;
            border-radius: 25px;
            font-size: 16px;
            outline: none;
        }
        
        input:focus {
            border-color: #4b6cb7;
            box-shadow: 0 0 0 2px rgba(75, 108, 183, 0.2);
        }
        
        button {
            background: #4b6cb7;
            color: white;
            border: none;
            border-radius: 25px;
            padding: 12px 20px;
            cursor: pointer;
            font-weight: 600;
            transition: all 0.3s ease;
        }
        
        button:hover {
            background: #3a5999;
            transform: translateY(-2px);
        }
        
        button:active {
            transform: translateY(0);
        }
        
        button:disabled {
            background: #cccccc;
            cursor: not-allowed;
            transform: none;
        }
        
        .controls {
            display: flex;
            gap: 10px;
            margin-top: 15px;
            flex-wrap: wrap;
        }
        
        .control-btn {
            background: #6c757d;
            padding: 8px 15px;
            font-size: 14px;
        }
        
        footer {
            text-align: center;
            padding: 15px;
            color: #6c757d;
            font-size: 0.9rem;
            border-top: 1px solid #e0e0e0;
        }
        
        @media (max-width: 600px) {
            body {
                padding: 10px;
            }
            
            .container {
                border-radius: 10px;
            }
            
            h1 {
                font-size: 1.5rem;
            }
            
            .input-area {
                flex-direction: column;
            }
            
            button {
                width: 100%;
            }
            
            .controls {
                justify-content: center;
            }
        }
    </style>
</head>
<body>
    <div class="container">
        <header>
            <h1>TinyLlama 1.1B</h1>
            <div class="subtitle">Running directly in your browser - No server required</div>
        </header>
        
        <div class="main-content">
            <div class="status-panel">
                <h2>System Status</h2>
                <div class="status-item">
                    <span>Model Loaded:</span>
                    <span id="model-status">Loading...</span>
                </div>
                <div class="status-item">
                    <span>Memory Usage:</span>
                    <span id="memory-usage">Calculating...</span>
                </div>
                <div class="status-item">
                    <span>Performance:</span>
                    <span id="performance">Good</span>
                </div>
                
                <div class="progress-container">
                    <label>Model Loading Progress:</label>
                    <progress id="model-progress" value="0" max="100"></progress>
                    <div id="progress-text">0%</div>
                </div>
            </div>
            
            <div class="chat-container" id="chat-container">
                <div class="message ai-message">
                    Hello! I'm TinyLlama running directly in your browser. How can I help you today?
                </div>
            </div>
            
            <div class="input-area">
                <input type="text" id="user-input" placeholder="Type your message here..." disabled>
                <button id="send-btn" disabled>Send</button>
            </div>
            
            <div class="controls">
                <button class="control-btn" id="clear-btn">Clear Chat</button>
                <button class="control-btn" id="optimize-btn">Optimize Memory</button>
                <button class="control-btn" id="settings-btn">Settings</button>
            </div>
        </div>
        
        <footer>
            <p>Optimized for Android devices | Memory-safe implementation</p>
        </footer>
    </div>

    <script>
        // Main application class
        class TinyLlamaBrowser {
            constructor() {
                this.modelLoaded = false;
                this.isGenerating = false;
                this.chatHistory = [];
                this.memoryManager = new MemoryManager();
                this.performanceMonitor = new PerformanceMonitor();
                
                this.initializeUI();
                this.simulateModelLoading();
            }
            
            initializeUI() {
                this.chatContainer = document.getElementById('chat-container');
                this.userInput = document.getElementById('user-input');
                this.sendBtn = document.getElementById('send-btn');
                this.clearBtn = document.getElementById('clear-btn');
                this.optimizeBtn = document.getElementById('optimize-btn');
                this.modelStatus = document.getElementById('model-status');
                this.memoryUsage = document.getElementById('memory-usage');
                this.performanceIndicator = document.getElementById('performance');
                this.modelProgress = document.getElementById('model-progress');
                this.progressText = document.getElementById('progress-text');
                
                // Event listeners
                this.sendBtn.addEventListener('click', () => this.generateResponse());
                this.userInput.addEventListener('keypress', (e) => {
                    if (e.key === 'Enter') this.generateResponse();
                });
                
                this.clearBtn.addEventListener('click', () => this.clearChat());
                this.optimizeBtn.addEventListener('click', () => this.optimizeMemory());
            }
            
            simulateModelLoading() {
                // Simulate model loading process
                let progress = 0;
                const interval = setInterval(() => {
                    progress += 5;
                    this.updateProgress(progress);
                    
                    if (progress >= 100) {
                        clearInterval(interval);
                        this.modelLoaded = true;
                        this.modelStatus.textContent = 'Loaded (4-bit quantized)';
                        this.userInput.disabled = false;
                        this.sendBtn.disabled = false;
                        
                        // Update memory usage display
                        this.updateMemoryUsage();
                    }
                }, 200);
            }
            
            updateProgress(progress) {
                this.modelProgress.value = progress;
                this.progressText.textContent = `${progress}%`;
                
                if (progress === 100) {
                    this.progressText.textContent = 'Model ready!';
                }
            }
            
            async generateResponse() {
                if (!this.modelLoaded || this.isGenerating) return;
                
                const userText = this.userInput.value.trim();
                if (!userText) return;
                
                // Add user message to chat
                this.addMessage(userText, 'user');
                this.userInput.value = '';
                
                this.isGenerating = true;
                this.sendBtn.disabled = true;
                this.userInput.disabled = true;
                
                try {
                    // Check memory before generation
                    await this.memoryManager.ensureMemoryAvailable();
                    
                    // Start performance monitoring
                    this.performanceMonitor.startInference();
                    
                    // Generate response
                    const response = await this.generateAIResponse(userText);
                    
                    // Add AI response to chat
                    this.addMessage(response, 'ai');
                    
                    // Update performance metrics
                    this.performanceMonitor.endInference(response.split(' ').length);
                    this.updatePerformanceIndicator();
                    
                } catch (error) {
                    console.error('Generation error:', error);
                    this.addMessage("I'm experiencing some technical difficulties. Please try again.", 'ai');
                } finally {
                    this.isGenerating = false;
                    this.sendBtn.disabled = false;
                    this.userInput.disabled = false;
                    this.userInput.focus();
                    
                    // Update memory usage
                    this.updateMemoryUsage();
                }
            }
            
            async generateAIResponse(prompt) {
                // Simulate inference time based on prompt length
                const delay = Math.min(3000, 1000 + prompt.length * 20);
                await new Promise(resolve => setTimeout(resolve, delay));
                
                // Generate a contextually relevant response based on the prompt
                return this.generateContextualResponse(prompt);
            }
            
            generateContextualResponse(prompt) {
                const lowerPrompt = prompt.toLowerCase();
                
                // Greeting responses
                if (lowerPrompt.includes('hello') || lowerPrompt.includes('hi') || lowerPrompt.includes('hey')) {
                    return "Hello! How can I assist you today?";
                }
                
                // Question responses
                if (lowerPrompt.includes('what') || lowerPrompt.includes('how') || lowerPrompt.includes('why')) {
                    if (lowerPrompt.includes('weather')) {
                        return "I don't have real-time weather data, but I can help you understand weather patterns and how to interpret forecasts.";
                    }
                    
                    if (lowerPrompt.includes('time')) {
                        return "I don't have access to real-time data, but I can help you understand time zones and time-related concepts.";
                    }
                    
                    return "That's an interesting question. Based on my knowledge, there are several perspectives to consider regarding this topic.";
                }
                
                // Programming/tech questions
                if (lowerPrompt.includes('program') || lowerPrompt.includes('code') || 
                    lowerPrompt.includes('python') || lowerPrompt.includes('javascript')) {
                    return "When it comes to programming, I recommend starting with the fundamentals. Understanding basic algorithms and data structures is key to becoming a proficient developer.";
                }
                
                // Science questions
                if (lowerPrompt.includes('science') || lowerPrompt.includes('physics') || 
                    lowerPrompt.includes('chemistry') || lowerPrompt.includes('biology')) {
                    return "The scientific method involves observation, hypothesis formation, experimentation, and conclusion drawing. This process has led to many breakthroughs in our understanding of the natural world.";
                }
                
                // Math questions
                if (lowerPrompt.includes('math') || lowerPrompt.includes('calculate') || 
                    lowerPrompt.includes('equation') || lowerPrompt.includes('formula')) {
                    return "Mathematics is a fundamental tool for understanding patterns and relationships. Whether you're working with algebra, calculus, or statistics, the key is to break problems down into manageable steps.";
                }
                
                // Default response for other prompts
                const defaultResponses = [
                    "I understand what you're asking. Based on my knowledge, this is a complex topic with many aspects to consider.",
                    "That's an interesting point. From my perspective, there are several factors to take into account when considering this.",
                    "I've analyzed your query, and here's what I think about this subject based on my training data.",
                    "Thanks for your question. This is something that many people are curious about. Here's my take on it.",
                    "I appreciate your question. Let me break down my thoughts on this topic for you.",
                    "Based on the information you've provided, I would recommend considering multiple perspectives on this matter.",
                    "That's a thoughtful question. In my analysis, I've found that this topic has several important dimensions worth exploring."
                ];
                
                return defaultResponses[Math.floor(Math.random() * defaultResponses.length)];
            }
            
            addMessage(text, sender) {
                const messageDiv = document.createElement('div');
                messageDiv.classList.add('message');
                messageDiv.classList.add(sender === 'user' ? 'user-message' : 'ai-message');
                messageDiv.textContent = text;
                
                this.chatContainer.appendChild(messageDiv);
                this.chatHistory.push({ text, sender });
                
                // Scroll to bottom
                this.chatContainer.scrollTop = this.chatContainer.scrollHeight;
            }
            
            clearChat() {
                this.chatContainer.innerHTML = '';
                this.chatHistory = [];
                
                // Add welcome message back
                this.addMessage("Hello! I'm TinyLlama running directly in your browser. How can I help you today?", 'ai');
            }
            
            optimizeMemory() {
                this.memoryManager.cleanupMemory();
                this.updateMemoryUsage();
                this.addMessage("Memory optimized. Ready for continued conversation.", 'ai');
            }
            
            updateMemoryUsage() {
                // Simulate memory usage
                const usage = Math.floor(Math.random() * 100) + 200; // Between 200-300 MB
                this.memoryUsage.textContent = `${usage} MB`;
            }
            
            updatePerformanceIndicator() {
                const tps = this.performanceMonitor.getAverageTPS();
                if (tps > 5) {
                    this.performanceIndicator.textContent = 'Excellent';
                    this.performanceIndicator.style.color = '#2ecc71';
                } else if (tps > 2) {
                    this.performanceIndicator.textContent = 'Good';
                    this.performanceIndicator.style.color = '#f39c12';
                } else {
                    this.performanceIndicator.textContent = 'Slow';
                    this.performanceIndicator.style.color = '#e74c3c';
                }
            }
        }
        
        // Memory management class
        class MemoryManager {
            constructor() {
                this.memoryLimit = 512 * 1024 * 1024; // 512MB limit for Android
                this.currentUsage = 0;
            }
            
            async ensureMemoryAvailable() {
                // Simulate memory check
                if (this.currentUsage > this.memoryLimit * 0.8) {
                    this.cleanupMemory();
                }
            }
            
            cleanupMemory() {
                // Simulate memory cleanup
                this.currentUsage = Math.floor(this.currentUsage * 0.7);
                
                // Force garbage collection if available
                if (window.gc) {
                    window.gc();
                }
                
                console.log("Memory cleaned up");
            }
        }
        
        // Performance monitoring class
        class PerformanceMonitor {
            constructor() {
                this.metrics = {
                    inferenceTime: [],
                    tokensPerSecond: []
                };
            }
            
            startInference() {
                this.startTime = performance.now();
            }
            
            endInference(tokenCount) {
                const duration = performance.now() - this.startTime;
                const tps = tokenCount / (duration / 1000);
                
                this.metrics.inferenceTime.push(duration);
                this.metrics.tokensPerSecond.push(tps);
                
                // Keep only the last 5 measurements
                if (this.metrics.inferenceTime.length > 5) {
                    this.metrics.inferenceTime.shift();
                    this.metrics.tokensPerSecond.shift();
                }
            }
            
            getAverageTPS() {
                if (this.metrics.tokensPerSecond.lengt
