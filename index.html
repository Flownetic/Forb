<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0"/>
  <title>TinyLlama Chat (CPU Mode)</title>
</head>
<body>
  <h2>TinyLlama Chat (WASM CPU Mode)</h2>
  <div id="chat" style="border:1px solid #ccc; padding:10px; height:300px; overflow-y:auto;"></div>
  <input id="userInput" type="text" placeholder="Type your message..." style="width:80%;">
  <button onclick="sendMessage()">Send</button>

  <script src="https://huggingface.github.io/llama.cpp/web/llama.js"></script>
  <script>
    let model;
    const chatBox = document.getElementById("chat");

    async function loadModel() {
      chatBox.innerHTML += "<div>Loading TinyLlama... (this may take a minute)</div>";
      model = await llama.loadModel({
        model: "https://huggingface.co/second-state/TinyLlama-1.1B-Chat-v1.0-GGUF/resolve/main/tinyllama-1.1b-chat.Q4_K_M.bin",
        wasmUrl: "https://huggingface.github.io/llama.cpp/web/llama.wasm"
      });
      chatBox.innerHTML += "<div>âœ… Model loaded! Start chatting.</div>";
    }

    async function sendMessage() {
      const input = document.getElementById("userInput");
      const userMsg = input.value;
      if (!userMsg.trim()) return;
      chatBox.innerHTML += `<div><b>You:</b> ${userMsg}</div>`;
      input.value = "";

      let reply = "";
      for await (const chunk of model.chat(userMsg)) {
        reply += chunk;
        document.getElementById("chat").lastElementChild?.remove();
        chatBox.innerHTML += `<div><b>Bot:</b> ${reply}</div>`;
        chatBox.scrollTop = chatBox.scrollHeight;
      }
    }

    loadModel();
  </script>
</body>
</html>
